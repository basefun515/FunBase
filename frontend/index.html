<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PumpFun Base - Create & Trade Memecoins</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0052FF;
            --secondary: #00D4FF;
            --success: #00DC82;
            --danger: #FF3366;
            --warning: #FFB800;
            --dark: #0A0E1A;
            --light: #1A1F2E;
            --text: #FFFFFF;
            --text-secondary: #8B92A8;
            --border: #2A3142;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--dark);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* Header */
        .header {
            background: rgba(26, 31, 46, 0.95);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s ease infinite;
            background-size: 200% 200%;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s;
            font-weight: 500;
        }

        .nav-link:hover {
            color: var(--text);
        }

        .wallet-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 82, 255, 0.4);
        }

        /* Hero Section */
        .hero {
            padding: 4rem 0;
            text-align: center;
            animation: slideIn 0.6s ease-out;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--text), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 82, 255, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text);
            padding: 1rem 2rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Stats Section */
        .stats {
            padding: 2rem 0;
            background: var(--light);
            border-radius: 20px;
            margin: 2rem 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
        }

        .stat-card {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Token Grid */
        .tokens-section {
            padding: 3rem 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 2rem;
            font-weight: bold;
        }

        .filter-tabs {
            display: flex;
            gap: 1rem;
            background: var(--light);
            padding: 0.25rem;
            border-radius: 12px;
        }

        .filter-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .filter-tab.active {
            background: var(--primary);
            color: white;
        }

        .tokens-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .token-card {
            background: var(--light);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .token-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .token-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(0, 82, 255, 0.2);
        }

        .token-card:hover::before {
            transform: scaleX(1);
        }

        .token-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .token-image {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
        }

        .token-info {
            flex: 1;
        }

        .token-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .token-symbol {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .token-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .token-stat {
            display: flex;
            flex-direction: column;
        }

        .token-stat-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .token-stat-value {
            font-weight: 600;
            font-size: 1rem;
        }

        .token-stat-value.green {
            color: var(--success);
        }

        .token-stat-value.red {
            color: var(--danger);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--light);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s;
            border: 1px solid var(--border);
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: var(--text);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 82, 255, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            border: 2px dashed var(--border);
            border-radius: 8px;
            transition: all 0.3s;
            background: var(--dark);
        }

        .file-upload:hover .file-upload-label {
            border-color: var(--primary);
            background: rgba(0, 82, 255, 0.05);
        }

        /* Trade Panel */
        .trade-panel {
            background: var(--light);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .trade-tabs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .trade-tab {
            padding: 0.75rem;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .trade-tab.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .input-group {
            position: relative;
            margin-bottom: 1rem;
        }

        .input-group input {
            padding-right: 4rem;
        }

        .input-suffix {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-weight: 500;
        }

        .price-info {
            background: var(--dark);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .price-row:last-child {
            margin-bottom: 0;
        }

        .price-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .price-value {
            font-weight: 500;
        }

        /* Chart */
        .chart-container {
            background: var(--light);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--light);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-color: var(--success);
        }

        .toast.error {
            border-color: var(--danger);
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .toast.success .toast-icon {
            background: var(--success);
            color: white;
        }

        .toast.error .toast-icon {
            background: var(--danger);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .tokens-grid {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <div class="logo">PumpFun Base</div>
                <div class="nav-links">
                    <a href="#" class="nav-link">Explore</a>
                    <a href="#" class="nav-link">Create</a>
                    <a href="#" class="nav-link">Portfolio</a>
                    <button class="wallet-btn" id="connectWallet">Connect Wallet</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Launch Your Memecoin on Base</h1>
            <p>Create, trade, and graduate tokens with just a few clicks</p>
            <div class="cta-buttons">
                <button class="btn-primary" id="createTokenBtn">Create Token</button>
                <a href="#tokens" class="btn-secondary">Explore Tokens</a>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="container">
        <div class="stats">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalTokens">0</div>
                    <div class="stat-label">Total Tokens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalVolume">$0</div>
                    <div class="stat-label">Total Volume</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="graduatedTokens">0</div>
                    <div class="stat-label">Graduated Tokens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">Active Users</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Tokens Section -->
    <section class="tokens-section" id="tokens">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Trending Tokens</h2>
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">All</button>
                    <button class="filter-tab" data-filter="new">New</button>
                    <button class="filter-tab" data-filter="trending">Trending</button>
                    <button class="filter-tab" data-filter="graduated">Graduated</button>
                </div>
            </div>
            <div class="tokens-grid" id="tokensGrid">
                <!-- Token cards will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Create Token Modal -->
    <div class="modal" id="createModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create Your Token</h2>
                <button class="close-btn" onclick="closeModal('createModal')">&times;</button>
            </div>
            <form id="createTokenForm">
                <div class="form-group">
                    <label class="form-label">Token Name</label>
                    <input type="text" class="form-input" id="tokenName" placeholder="e.g., Based Pepe" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Token Symbol</label>
                    <input type="text" class="form-input" id="tokenSymbol" placeholder="e.g., BPEPE" maxlength="10" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input form-textarea" id="tokenDescription" placeholder="Tell us about your token..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Image URL</label>
                    <input type="url" class="form-input" id="tokenImage" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label class="form-label">Twitter</label>
                    <input type="url" class="form-input" id="tokenTwitter" placeholder="https://twitter.com/...">
                </div>
                <div class="form-group">
                    <label class="form-label">Telegram</label>
                    <input type="url" class="form-input" id="tokenTelegram" placeholder="https://t.me/...">
                </div>
                <div class="form-group">
                    <label class="form-label">Website</label>
                    <input type="url" class="form-input" id="tokenWebsite" placeholder="https://...">
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">
                    Create Token (0.002 ETH)
                </button>
            </form>
        </div>
    </div>

    <!-- Token Detail Modal -->
    <div class="modal" id="tokenModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTokenName">Token Name</h2>
                <button class="close-btn" onclick="closeModal('tokenModal')">&times;</button>
            </div>
            
            <!-- Chart -->
            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>

            <!-- Trade Panel -->
            <div class="trade-panel">
                <div class="trade-tabs">
                    <button class="trade-tab active" onclick="setTradeMode('buy')">Buy</button>
                    <button class="trade-tab" onclick="setTradeMode('sell')">Sell</button>
                </div>
                
                <form id="tradeForm">
                    <div class="input-group">
                        <input type="number" class="form-input" id="tradeAmount" placeholder="0.0" step="0.01" required>
                        <span class="input-suffix" id="tradeSuffix">ETH</span>
                    </div>
                    
                    <div class="price-info">
                        <div class="price-row">
                            <span class="price-label">Price</span>
                            <span class="price-value" id="tokenPrice">0.000001 ETH</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">You'll receive</span>
                            <span class="price-value" id="receiveAmount">0 TOKENS</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">Platform fee (1%)</span>
                            <span class="price-value" id="platformFee">0 ETH</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-primary" style="width: 100%;" id="tradeButton">
                        Buy
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon" id="toastIcon"></div>
        <div class="toast-message" id="toastMessage"></div>
    </div>

    <script>
        // Contract addresses - REPLACE THESE WITH YOUR DEPLOYED ADDRESSES
        const FACTORY_ADDRESS = '0x0000000000000000000000000000000000000000'; // Replace with deployed factory
        const FACTORY_ABI = [
            "function createToken(string name, string symbol, string description, string imageUrl, string twitter, string telegram, string website) payable returns (address)",
            "function buyToken(address token, uint256 minTokensOut) payable returns (uint256)",
            "function sellToken(address token, uint256 tokensIn, uint256 minEthOut) returns (uint256)",
            "function getTokenDetails(address token) view returns (tuple(string name, string symbol, string description, string imageUrl, string twitter, string telegram, string website, address creator, uint256 createdAt, uint256 marketCap, bool isGraduated) info, tuple(uint256 ethReserve, uint256 tokenReserve, uint256 k, uint256 totalRaised, uint256 graduationTarget) curve, tuple(uint256 totalVolume, uint256 buyCount, uint256 sellCount, uint256 uniqueTraders, uint256 highestPrice, uint256 lastPrice) stats, uint256 price)",
            "function tokenCreationFee() view returns (uint256)",
            "function totalTokensCreated() view returns (uint256)",
            "function totalGraduatedTokens() view returns (uint256)",
            "function getUserTokens(address user) view returns (address[])",
            "event TokenCreated(address indexed token, address indexed creator, string name, string symbol, uint256 timestamp)",
            "event TokenPurchased(address indexed token, address indexed buyer, uint256 ethIn, uint256 tokensOut, uint256 newPrice)",
            "event TokenSold(address indexed token, address indexed seller, uint256 tokensIn, uint256 ethOut, uint256 newPrice)"
        ];

        const ERC20_ABI = [
            "function approve(address spender, uint256 amount) returns (bool)",
            "function balanceOf(address account) view returns (uint256)",
            "function symbol() view returns (string)",
            "function decimals() view returns (uint8)"
        ];

        // Global variables
        let provider, signer, factory, userAddress;
        let currentToken = null;
        let tradeMode = 'buy';
        let priceChart = null;

        // Initialize app
        async function init() {
            // Check if MetaMask is installed
            if (typeof window.ethereum === 'undefined') {
                showToast('Please install MetaMask to use this app', 'error');
                return;
            }

            // Set up event listeners
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
            document.getElementById('createTokenBtn').addEventListener('click', () => openModal('createModal'));
            document.getElementById('createTokenForm').addEventListener('submit', handleCreateToken);
            document.getElementById('tradeForm').addEventListener('submit', handleTrade);
            document.getElementById('tradeAmount').addEventListener('input', updateTradePreview);

            // Filter tabs
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                    loadTokens(e.target.dataset.filter);
                });
            });

            // Load initial data
            await loadStats();
            await loadTokens('all');

            // Set up real-time updates
            setInterval(loadStats, 30000); // Update stats every 30 seconds
            setInterval(() => loadTokens(getCurrentFilter()), 10000); // Update tokens every 10 seconds
        }

        // Connect wallet
        async function connectWallet() {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAddress = accounts[0];
                
                // Check network
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== '0x2105') { // Base mainnet
                    showToast('Please switch to Base network', 'error');
                    await switchToBase();
                    return;
                }

                // Set up provider and signer
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                factory = new ethers.Contract(FACTORY_ADDRESS, FACTORY_ABI, signer);

                // Update UI
                document.getElementById('connectWallet').textContent = 
                    userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
                
                showToast('Wallet connected!', 'success');
            } catch (error) {
                console.error('Connection error:', error);
                showToast('Failed to connect wallet', 'error');
            }
        }

        // Switch to Base network
        async function switchToBase() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x2105' }], // Base mainnet
                });
            } catch (error) {
                if (error.code === 4902) {
                    // Add Base network
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: '0x2105',
                            chainName: 'Base',
                            nativeCurrency: {
                                name: 'Ethereum',
                                symbol: 'ETH',
                                decimals: 18
                            },
                            rpcUrls: ['https://mainnet.base.org'],
                            blockExplorerUrls: ['https://basescan.org']
                        }]
                    });
                }
            }
        }

        // Load stats
        async function loadStats() {
            try {
                if (!provider) {
                    provider = new ethers.providers.JsonRpcProvider('https://mainnet.base.org');
                }
                
                const tempFactory = new ethers.Contract(FACTORY_ADDRESS, FACTORY_ABI, provider);
                
                const totalTokens = await tempFactory.totalTokensCreated();
                const graduatedTokens = await tempFactory.totalGraduatedTokens();
                
                document.getElementById('totalTokens').textContent = totalTokens.toString();
                document.getElementById('graduatedTokens').textContent = graduatedTokens.toString();
                
                // Mock data for demo
                document.getElementById('totalVolume').textContent = ' + formatNumber(Math.random() * 1000000);
                document.getElementById('totalUsers').textContent = formatNumber(Math.floor(Math.random() * 10000));
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load tokens
        async function loadTokens(filter) {
            try {
                const tokensGrid = document.getElementById('tokensGrid');
                tokensGrid.innerHTML = '<div class="loading"></div>';

                // In production, you would fetch real tokens from your backend or events
                // For demo, we'll create mock data
                const mockTokens = generateMockTokens(12);
                
                tokensGrid.innerHTML = '';
                mockTokens.forEach(token => {
                    tokensGrid.appendChild(createTokenCard(token));
                });
            } catch (error) {
                console.error('Error loading tokens:', error);
                document.getElementById('tokensGrid').innerHTML = 
                    '<p style="text-align: center; color: var(--text-secondary);">Failed to load tokens</p>';
            }
        }

        // Create token card
        function createTokenCard(token) {
            const card = document.createElement('div');
            card.className = 'token-card';
            card.onclick = () => openTokenModal(token);
            
            const priceChange = ((Math.random() - 0.5) * 100).toFixed(2);
            const isPositive = priceChange > 0;
            
            card.innerHTML = `
                <div class="token-header">
                    <div class="token-image">${token.symbol.charAt(0)}</div>
                    <div class="token-info">
                        <div class="token-name">${token.name}</div>
                        <div class="token-symbol">${token.symbol}</div>
                    </div>
                </div>
                <div class="token-stats">
                    <div class="token-stat">
                        <div class="token-stat-label">Price</div>
                        <div class="token-stat-value">${token.price.toFixed(6)}</div>
                    </div>
                    <div class="token-stat">
                        <div class="token-stat-label">24h Change</div>
                        <div class="token-stat-value ${isPositive ? 'green' : 'red'}">
                            ${isPositive ? '+' : ''}${priceChange}%
                        </div>
                    </div>
                    <div class="token-stat">
                        <div class="token-stat-label">Market Cap</div>
                        <div class="token-stat-value">${formatNumber(token.marketCap)}</div>
                    </div>
                    <div class="token-stat">
                        <div class="token-stat-label">Volume</div>
                        <div class="token-stat-value">${formatNumber(token.volume)}</div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Handle create token
        async function handleCreateToken(e) {
            e.preventDefault();
            
            if (!signer) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> Creating...';

            try {
                const name = document.getElementById('tokenName').value;
                const symbol = document.getElementById('tokenSymbol').value;
                const description = document.getElementById('tokenDescription').value;
                const imageUrl = document.getElementById('tokenImage').value;
                const twitter = document.getElementById('tokenTwitter').value;
                const telegram = document.getElementById('tokenTelegram').value;
                const website = document.getElementById('tokenWebsite').value;

                const fee = await factory.tokenCreationFee();
                
                const tx = await factory.createToken(
                    name, symbol, description, imageUrl, twitter, telegram, website,
                    { value: fee }
                );
                
                showToast('Creating token... Please wait', 'success');
                
                const receipt = await tx.wait();
                const event = receipt.events.find(e => e.event === 'TokenCreated');
                const tokenAddress = event.args.token;
                
                showToast('Token created successfully!', 'success');
                closeModal('createModal');
                
                // Reset form
                e.target.reset();
                
                // Reload tokens
                await loadTokens('new');
                
            } catch (error) {
                console.error('Error creating token:', error);
                showToast(error.message || 'Failed to create token', 'error');
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        }

        // Open token modal
        async function openTokenModal(token) {
            currentToken = token;
            document.getElementById('modalTokenName').textContent = token.name;
            
            // Initialize chart
            initPriceChart();
            
            // Set trade mode to buy
            setTradeMode('buy');
            
            openModal('tokenModal');
            
            // Load token details
            if (token.address && factory) {
                try {
                    const details = await factory.getTokenDetails(token.address);
                    // Update UI with real details
                    updateTokenModal(details);
                } catch (error) {
                    console.error('Error loading token details:', error);
                }
            }
        }

        // Initialize price chart
        function initPriceChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (priceChart) {
                priceChart.destroy();
            }
            
            // Generate mock price data
            const labels = [];
            const data = [];
            const basePrice = currentToken.price;
            
            for (let i = 23; i >= 0; i--) {
                labels.push(`${i}h`);
                data.push(basePrice * (0.8 + Math.random() * 0.4));
            }
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Price',
                        data: data,
                        borderColor: '#0052FF',
                        backgroundColor: 'rgba(0, 82, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#8B92A8'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#8B92A8',
                                callback: function(value) {
                                    return '
                 + value.toFixed(6);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Set trade mode
        function setTradeMode(mode) {
            tradeMode = mode;
            document.querySelectorAll('.trade-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const suffix = document.getElementById('tradeSuffix');
            const button = document.getElementById('tradeButton');
            
            if (mode === 'buy') {
                suffix.textContent = 'ETH';
                button.textContent = 'Buy';
                button.style.background = 'linear-gradient(135deg, #00DC82, #00D4FF)';
            } else {
                suffix.textContent = currentToken.symbol;
                button.textContent = 'Sell';
                button.style.background = 'linear-gradient(135deg, #FF3366, #FF6B6B)';
            }
            
            updateTradePreview();
        }

        // Update trade preview
        async function updateTradePreview() {
            const amount = parseFloat(document.getElementById('tradeAmount').value) || 0;
            const receiveElement = document.getElementById('receiveAmount');
            const feeElement = document.getElementById('platformFee');
            
            if (amount <= 0) {
                receiveElement.textContent = '0 ' + (tradeMode === 'buy' ? currentToken.symbol : 'ETH');
                feeElement.textContent = '0 ETH';
                return;
            }
            
            const fee = amount * 0.01; // 1% fee
            
            if (tradeMode === 'buy') {
                // Calculate tokens out
                const tokensOut = (amount - fee) / currentToken.price;
                receiveElement.textContent = formatNumber(tokensOut) + ' ' + currentToken.symbol;
                feeElement.textContent = fee.toFixed(6) + ' ETH';
            } else {
                // Calculate ETH out
                const ethOut = amount * currentToken.price;
                const ethFee = ethOut * 0.01;
                receiveElement.textContent = (ethOut - ethFee).toFixed(6) + ' ETH';
                feeElement.textContent = ethFee.toFixed(6) + ' ETH';
            }
        }

        // Handle trade
        async function handleTrade(e) {
            e.preventDefault();
            
            if (!signer) {
                showToast('Please connect your wallet first', 'error');
                return;
            }
            
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> Processing...';
            
            try {
                const amount = parseFloat(document.getElementById('tradeAmount').value);
                
                if (tradeMode === 'buy') {
                    const value = ethers.utils.parseEther(amount.toString());
                    const minTokensOut = 0; // In production, calculate slippage
                    
                    const tx = await factory.buyToken(currentToken.address, minTokensOut, { value });
                    showToast('Buying tokens... Please wait', 'success');
                    await tx.wait();
                    showToast('Purchase successful!', 'success');
                } else {
                    // First approve token
                    const tokenContract = new ethers.Contract(currentToken.address, ERC20_ABI, signer);
                    const tokenAmount = ethers.utils.parseEther(amount.toString());
                    
                    const approval = await tokenContract.approve(FACTORY_ADDRESS, tokenAmount);
                    showToast('Approving tokens...', 'success');
                    await approval.wait();
                    
                    const minEthOut = 0; // In production, calculate slippage
                    const tx = await factory.sellToken(currentToken.address, tokenAmount, minEthOut);
                    showToast('Selling tokens... Please wait', 'success');
                    await tx.wait();
                    showToast('Sale successful!', 'success');
                }
                
                // Reset form
                e.target.reset();
                updateTradePreview();
                
            } catch (error) {
                console.error('Trade error:', error);
                showToast(error.message || 'Transaction failed', 'error');
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        }

        // Utility functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = '';
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const msg = document.getElementById('toastMessage');
            
            toast.className = 'toast ' + type;
            icon.textContent = type === 'success' ? '✓' : '✕';
            msg.textContent = message;
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function formatNumber(num) {
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toFixed(2);
        }

        function getCurrentFilter() {
            return document.querySelector('.filter-tab.active').dataset.filter;
        }

        function generateMockTokens(count) {
            const names = ['Based Pepe', 'Moon Cat', 'Rocket Doge', 'Diamond Hands', 'WAGMI Coin', 'Hopium Token'];
            const symbols = ['BPEPE', 'MCAT', 'RDOGE', 'DIAMOND', 'WAGMI', 'HOPIUM'];
            const tokens = [];
            
            for (let i = 0; i < count; i++) {
                const idx = i % names.length;
                tokens.push({
                    address: '0x' + Math.random().toString(16).substr(2, 40),
                    name: names[idx] + (i >= names.length ? ' ' + Math.floor(i / names.length + 1) : ''),
                    symbol: symbols[idx],
                    price: Math.random() * 0.001,
                    marketCap: Math.random() * 1000000,
                    volume: Math.random() * 100000,
                    change24h: (Math.random() - 0.5) * 100
                });
            }
            
            return tokens;
        }

        // Listen for account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    userAddress = null;
                    signer = null;
                    document.getElementById('connectWallet').textContent = 'Connect Wallet';
                } else {
                    connectWallet();
                }
            });
            
            window.ethereum.on('chainChanged', () => {
                window.location.reload();
            });
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
