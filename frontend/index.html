<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PumpFun Base - Create & Trade Memecoins</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0052FF;
            --secondary: #00D4FF;
            --success: #00DC82;
            --danger: #FF3366;
            --warning: #FFB800;
            --dark: #0A0E1A;
            --light: #1A1F2E;
            --text: #FFFFFF;
            --text-secondary: #8B92A8;
            --border: #2A3142;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--dark);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: rgba(26, 31, 46, 0.95);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s;
            font-weight: 500;
        }

        .nav-link:hover {
            color: var(--text);
        }

        .wallet-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 82, 255, 0.4);
        }

        .hero {
            padding: 4rem 0;
            text-align: center;
            animation: slideIn 0.6s ease-out;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--text), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 82, 255, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text);
            padding: 1rem 2rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .stats {
            padding: 2rem 0;
            background: var(--light);
            border-radius: 20px;
            margin: 2rem 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
        }

        .stat-card {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .tokens-section {
            padding: 3rem 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 2rem;
            font-weight: bold;
        }

        .filter-tabs {
            display: flex;
            gap: 1rem;
            background: var(--light);
            padding: 0.25rem;
            border-radius: 12px;
        }

        .filter-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .filter-tab.active {
            background: var(--primary);
            color: white;
        }

        .tokens-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .token-card {
            background: var(--light);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .token-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(0, 82, 255, 0.2);
        }

        .token-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .token-image {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
        }

        .token-info {
            flex: 1;
        }

        .token-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .token-symbol {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .token-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .token-stat {
            display: flex;
            flex-direction: column;
        }

        .token-stat-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .token-stat-value {
            font-weight: 600;
            font-size: 1rem;
        }

        .token-stat-value.green {
            color: var(--success);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--light);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s;
            border: 1px solid var(--border);
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: var(--text);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 82, 255, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--light);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-color: var(--success);
        }

        .toast.error {
            border-color: var(--danger);
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .toast.success .toast-icon {
            background: var(--success);
            color: white;
        }

        .toast.error .toast-icon {
            background: var(--danger);
            color: white;
        }

        .trade-panel {
            background: var(--light);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .trade-tabs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .trade-tab {
            padding: 0.75rem;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .trade-tab.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .input-group {
            position: relative;
            margin-bottom: 1rem;
        }

        .input-group input {
            padding-right: 4rem;
        }

        .input-suffix {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-weight: 500;
        }

        .price-info {
            background: var(--dark);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .price-row:last-child {
            margin-bottom: 0;
        }

        .price-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .price-value {
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .tokens-grid {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <div class="logo">PumpFun Base</div>
                <div class="nav-links">
                    <a href="#tokens" class="nav-link">Explore</a>
                    <a href="#" class="nav-link" onclick="openModal('createModal'); return false;">Create</a>
                    <button class="wallet-btn" id="connectWallet">Connect Wallet</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Launch Your Memecoin on Base</h1>
            <p>Create, trade, and graduate tokens with just a few clicks</p>
            <div class="cta-buttons">
                <button class="btn-primary" id="createTokenBtn">Create Token</button>
                <a href="#tokens" class="btn-secondary">Explore Tokens</a>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="container">
        <div class="stats">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalTokens">0</div>
                    <div class="stat-label">Total Tokens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalVolume">$0</div>
                    <div class="stat-label">Total Volume</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="graduatedTokens">0</div>
                    <div class="stat-label">Graduated Tokens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">Active Users</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Tokens Section -->
    <section class="tokens-section" id="tokens">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Trending Tokens</h2>
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">All</button>
                    <button class="filter-tab" data-filter="new">New</button>
                    <button class="filter-tab" data-filter="trending">Trending</button>
                    <button class="filter-tab" data-filter="graduated">Graduated</button>
                </div>
            </div>
            <div class="tokens-grid" id="tokensGrid">
                <!-- Token cards will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Create Token Modal -->
    <div class="modal" id="createModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create Your Token</h2>
                <button class="close-btn" onclick="closeModal('createModal')">&times;</button>
            </div>
            <form id="createTokenForm">
                <div class="form-group">
                    <label class="form-label">Token Name</label>
                    <input type="text" class="form-input" id="tokenName" placeholder="e.g., Based Pepe" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Token Symbol</label>
                    <input type="text" class="form-input" id="tokenSymbol" placeholder="e.g., BPEPE" maxlength="10" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input form-textarea" id="tokenDescription" placeholder="Tell us about your token..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Image URL</label>
                    <input type="url" class="form-input" id="tokenImage" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label class="form-label">Twitter</label>
                    <input type="url" class="form-input" id="tokenTwitter" placeholder="https://twitter.com/...">
                </div>
                <div class="form-group">
                    <label class="form-label">Telegram</label>
                    <input type="url" class="form-input" id="tokenTelegram" placeholder="https://t.me/...">
                </div>
                <div class="form-group">
                    <label class="form-label">Website</label>
                    <input type="url" class="form-input" id="tokenWebsite" placeholder="https://...">
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">
                    Create Token (0.002 ETH)
                </button>
            </form>
        </div>
    </div>

    <!-- Token Detail Modal -->
    <div class="modal" id="tokenModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTokenName">Token Name</h2>
                <button class="close-btn" onclick="closeModal('tokenModal')">&times;</button>
            </div>
            
            <!-- Token Info -->
            <div style="margin-bottom: 2rem; padding: 1rem; background: var(--dark); border-radius: 12px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Symbol</div>
                        <div id="modalTokenSymbol" style="font-weight: 600;"></div>
                    </div>
                    <div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Price</div>
                        <div id="modalTokenPrice" style="font-weight: 600;"></div>
                    </div>
                    <div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Market Cap</div>
                        <div id="modalTokenMarketCap" style="font-weight: 600;"></div>
                    </div>
                    <div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Liquidity</div>
                        <div id="modalTokenLiquidity" style="font-weight: 600;"></div>
                    </div>
                </div>
            </div>

            <!-- Trade Panel -->
            <div class="trade-panel">
                <div class="trade-tabs">
                    <button class="trade-tab active" onclick="setTradeMode('buy', event)">Buy</button>
                    <button class="trade-tab" onclick="setTradeMode('sell', event)">Sell</button>
                </div>
                
                <form id="tradeForm">
                    <div class="input-group">
                        <input type="number" class="form-input" id="tradeAmount" placeholder="0.0" step="0.001" min="0.001" required>
                        <span class="input-suffix" id="tradeSuffix">ETH</span>
                    </div>
                    
                    <div class="price-info">
                        <div class="price-row">
                            <span class="price-label">You'll receive</span>
                            <span class="price-value" id="receiveAmount">0 TOKENS</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">Price Impact</span>
                            <span class="price-value" id="priceImpact">0%</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">Platform fee (1%)</span>
                            <span class="price-value" id="platformFee">0 ETH</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;" id="tradeButton">
                        Buy
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon" id="toastIcon"></div>
        <div class="toast-message" id="toastMessage"></div>
    </div>

    <script>
        // Contract configuration
        const FACTORY_ADDRESS = '0x7730469828858529df36A22efB08520C73362244';
        const FACTORY_ABI = [
            "function createToken(string name, string symbol, string description, string imageUrl, string twitter, string telegram, string website) payable returns (address)",
            "function buyToken(address token, uint256 minTokensOut) payable returns (uint256)",
            "function sellToken(address token, uint256 tokensIn, uint256 minEthOut) returns (uint256)",
            "function tokenCreationFee() view returns (uint256)",
            "function totalTokensCreated() view returns (uint256)",
            "function totalGraduatedTokens() view returns (uint256)",
            "function getTokenDetails(address token) view returns (tuple(string name, string symbol, string description, string imageUrl, string twitter, string telegram, string website, address creator, uint256 createdAt, uint256 marketCap, bool isGraduated) info, tuple(uint256 ethReserve, uint256 tokenReserve, uint256 k, uint256 totalRaised, uint256 graduationTarget) curve, tuple(uint256 totalVolume, uint256 buyCount, uint256 sellCount, uint256 uniqueTraders, uint256 highestPrice, uint256 lastPrice) stats, uint256 price)",
            "event TokenCreated(address indexed token, address indexed creator, string name, string symbol, uint256 timestamp)"
        ];

        const ERC20_ABI = [
            "function approve(address spender, uint256 amount) returns (bool)",
            "function balanceOf(address account) view returns (uint256)",
            "function symbol() view returns (string)"
        ];

        // Global variables
        let provider, signer, factory, userAddress;
        let currentToken = null;
        let currentTokenDetails = null;
        let tradeMode = 'buy';

        // Initialize app
        async function init() {
            console.log("Initializing app...");
            
            if (typeof window.ethereum === 'undefined') {
                showToast('Please install MetaMask to use this app', 'error');
                return;
            }

            // Event listeners
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
            document.getElementById('createTokenBtn').addEventListener('click', () => openModal('createModal'));
            document.getElementById('createTokenForm').addEventListener('submit', handleCreateToken);
            document.getElementById('tradeForm').addEventListener('submit', handleTrade);
            document.getElementById('tradeAmount').addEventListener('input', updateTradePreview);

            // Load initial data
            try {
                provider = new ethers.providers.JsonRpcProvider('https://sepolia.base.org');
                await loadStats();
                await loadTokens();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Connect wallet
        async function connectWallet() {
            try {
                console.log("Connecting wallet...");
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAddress = accounts[0];
                
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== '0x14a34') {
                    showToast('Please switch to Base Sepolia network', 'error');
                    return;
                }

                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                factory = new ethers.Contract(FACTORY_ADDRESS, FACTORY_ABI, signer);

                document.getElementById('connectWallet').textContent = 
                    userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
                
                showToast('Wallet connected!', 'success');
            } catch (error) {
                console.error('Error:', error);
                showToast('Failed to connect wallet', 'error');
            }
        }

        // Load stats
        async function loadStats() {
            try {
                const tempFactory = new ethers.Contract(FACTORY_ADDRESS, FACTORY_ABI, provider);
                const totalTokens = await tempFactory.totalTokensCreated();
                const graduatedTokens = await tempFactory.totalGraduatedTokens();
                
                document.getElementById('totalTokens').textContent = totalTokens.toString();
                document.getElementById('graduatedTokens').textContent = graduatedTokens.toString();
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Create token
        async function handleCreateToken(e) {
            e.preventDefault();
            
            if (!signer) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            const button = e.target.querySelector('button[type="submit"]');
            button.disabled = true;
            button.textContent = 'Creating...';

            try {
                const name = document.getElementById('tokenName').value;
                const symbol = document.getElementById('tokenSymbol').value;
                const description = document.getElementById('tokenDescription').value || '';
                const imageUrl = document.getElementById('tokenImage').value || '';
                const twitter = document.getElementById('tokenTwitter').value || '';
                const telegram = document.getElementById('tokenTelegram').value || '';
                const website = document.getElementById('tokenWebsite').value || '';

                const fee = await factory.tokenCreationFee();
                const tx = await factory.createToken(
                    name, symbol, description, imageUrl, twitter, telegram, website,
                    { value: fee }
                );
                
                showToast('Creating token... Please wait', 'success');
                await tx.wait();
                
                showToast('Token created successfully!', 'success');
                closeModal('createModal');
                e.target.reset();
                await loadStats();
                await loadTokens();
                
            } catch (error) {
                console.error('Error:', error);
                showToast('Failed to create token', 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'Create Token (0.002 ETH)';
            }
        }

        // Load tokens
        async function loadTokens() {
            try {
                console.log("Loading tokens...");
                const tokensGrid = document.getElementById('tokensGrid');
                tokensGrid.innerHTML = '<div class="loading"></div>';

                const tempFactory = new ethers.Contract(FACTORY_ADDRESS, FACTORY_ABI, provider);
                
                // Get current block
                const currentBlock = await provider.getBlockNumber();
                const fromBlock = Math.max(0, currentBlock - 5000); // Last 5k blocks
                
                // Get TokenCreated events
                const filter = tempFactory.filters.TokenCreated();
                const events = await tempFactory.queryFilter(filter, fromBlock, currentBlock);
                
                console.log("Found tokens:", events.length);
                
                if (events.length === 0) {
                    tokensGrid.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No tokens created yet. Be the first!</p>';
                    return;
                }

                tokensGrid.innerHTML = '';
                
                // Display tokens (newest first, max 10)
                for (let i = events.length - 1; i >= 0 && i >= events.length - 10; i--) {
                    const event = events[i];
                    const tokenAddress = event.args.token;
                    
                    try {
                        const details = await tempFactory.getTokenDetails(tokenAddress);
                        const tokenCard = createTokenCard(tokenAddress, details);
                        tokensGrid.appendChild(tokenCard);
                    } catch (error) {
                        console.error('Error loading token:', error);
                    }
                }
            } catch (error) {
                console.error('Error loading tokens:', error);
                document.getElementById('tokensGrid').innerHTML = 
                    '<p style="text-align: center; color: var(--text-secondary);">Unable to load tokens</p>';
            }
        }

        // Create token card
        function createTokenCard(address, details) {
            const card = document.createElement('div');
            card.className = 'token-card';
            
            const info = details.info;
            const price = ethers.utils.formatEther(details.price);
            
            card.innerHTML = `
                <div class="token-header">
                    <div class="token-image">${info.symbol.charAt(0)}</div>
                    <div class="token-info">
                        <div class="token-name">${info.name}</div>
                        <div class="token-symbol">${info.symbol}</div>
                    </div>
                </div>
                <div class="token-stats">
                    <div class="token-stat">
                        <div class="token-stat-label">Price</div>
                        <div class="token-stat-value">${parseFloat(price).toFixed(8)} ETH</div>
                    </div>
                    <div class="token-stat">
                        <div class="token-stat-label">Market Cap</div>
                        <div class="token-stat-value">${formatNumber(parseFloat(ethers.utils.formatEther(info.marketCap)))}</div>
                    </div>
                    <div class="token-stat">
                        <div class="token-stat-label">Creator</div>
                        <div class="token-stat-value">${info.creator.slice(0, 6)}...${info.creator.slice(-4)}</div>
                    </div>
                    <div class="token-stat">
                        <div class="token-stat-label">Status</div>
                        <div class="token-stat-value ${info.isGraduated ? 'green' : ''}">${info.isGraduated ? 'Graduated' : 'Active'}</div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Format number helper
        function formatNumber(num) {
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toFixed(2);
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Toast function
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const msg = document.getElementById('toastMessage');
            
            toast.className = 'toast ' + type;
            icon.textContent = type === 'success' ? '✓' : '✕';
            msg.textContent = message;
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
